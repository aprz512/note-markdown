# 中点圆算法

当我们在手机屏幕上绘制一个圆的时候，有没有想过这个圆是怎么绘制出来的呢？由于屏幕的像素是一粒一粒的，所以不像我们在一张纸上，可以利用 sin/cos 函数计算出来。

看一张图：

![](F:\note-markdown\中点圆算法\Bresenham_circle.png)

将手机屏幕放大了看，你就会看到上图所示的情景，那么这些像素点的位置是如何计算出来的呢？其实就是使用了中点圆算法。



**在计算机图形学中，中点圆算法是一种用于确定绘制一个圆所需的像素点的算法。**



### 算法概念

该算法的目标是找到一个通过使用像素网格的使得每个像素点尽可能接近 $x^2 + y^2 = R^2$ 的路径。



### 准备工作

由于圆具有对称性，所以我们只要考虑1/8个圆即可，我们选择y轴正方向到延其顺时针旋转45°的这个区间为例。就是上图中的 `2nd octant` 区域。

我们先假设要画的圆的圆心在坐标原点，最后再平移到其应该存在的位置。

设要画的圆的圆心在原点**(0，0)**，半径为**R**，起点在**(0，R)**处，终点在 $(\frac{R}{\sqrt2}, \frac{R}{\sqrt2})$ 处，顺时针生成八分之一圆，利用对称性画出全部的圆。

为了应用中点画圆法，我们还需要定义一个检测函数：
$$
F(x, y) = x^2 + y^2 - R^2
$$
任何点 (x，y) 的相对位置可由圆函数的符号来检测：

- <0　点(x，y)位于数学圆内
　　- =0　点(x，y)位于数学圆上
- \>0　点(x，y)位于数学圆外



### 算法演示

如下图所示，图中有两条圆弧A和B，假定当前取点为$P_i(x_i, y_i)$，如果顺时针生成圆，那么下一点只能取正右方的点 $E(x_i, y_i)$ 或者右下方的 $SE(x_i+1, y_i-1)$。 

![图1](F:\note-markdown\中点圆算法\midpoint_cicle.png)

假设M是E和SE的中点，即，则：

1、对圆A来说，F(M)<0，M在圆A内，这说明点E距离圆更近，应取点E作为下一象素点；
2、对圆B来说，当F(M)>0，M在圆B外，表明SE点离圆更近，应取SE点为下一象素点；
3、而当F(M)=0时，在E点与SE点之中随便取一个即可，我们约定取SE点。



### 算法推导

我们将中点M代入检测函数可以得到一个值，用 $d_i$表示，它就是该点的决策变量，然后我们再用它来推导出下一个中点决策变量 $d_{i+1}$ 。

$$ d_i = F(x_i+1， y_i-\frac{1}{2}) = (x_i+1)^2 + (y_i - \frac{1}{2})^2 - R^2 $$

下面分两种情况来讨论在迭代计算中决策变量  $d_{i+1}$ 的推导。

看上面的算法演示图：

- 如果 $d_i < 0$，则选择E点，接着下一个中点就是 $M_E(x_i+2,y_i-\frac{1}{2})$，这时新的决策变量为：

  $$ d_{i+1} = F(x_i+2， y_i-\frac{1}{2}) = (x_i+2)^2 + (y_i - \frac{1}{2})^2 - R^2 $$

  用 $d_{i+1}$ - $d_i$，可以得到： 

  $$ d_{i+1} = d_i  + 2x_i   + 3$$

- 如果 $d_i > 0$ ，则选择 SE 点，接着下一个中点就是$M_{SE}(x_i+2,y_i-\frac{3}{2})$，这时新的决策变量为：

  $$d_{i+1} = F(x_i+2, y_i-\frac{3}{2}) = (x_i+2)^2 + (y_i-\frac{3}{2})^2 - R^2$$

  用 $d_{i+1}$ - $d_i$，可以得到： 

  $$d_{i+1} = d_i  + 2(x_i-y_i)   + 5$$

我们利用递推迭代计算这八分之一圆弧上的每个点，每次迭代需要两步处理：

（1）用前一次迭代算出的决策变量的正负来决定本次选择的点

（2）对本次选择的点，递推计算得出新的决策变量的值

接下来只要计算出初始决策变量$d_0$的值即可，对于初始坐标$(0,R)$，显然顺时针生成的下一个决策点坐标是$(1, R-\frac{1}{2})$，此时决策变量 $d_0$为：$d_0 = (1)^2 + (R-\frac{1}{2})^2 - R^2 = \frac{5}{4} - R$ 。显然，如果半径大于 $\frac{5}{4}$，则我们应该取 E 点，否则取 SE 点。

就这样不断的递推下去，就可以得到八分之一圆弧的所有点。

### 算法表示

输入：圆半径$R$、圆心$(x_0，y_0)$，

确定初值：$x=0$，$y=R$，$d=\frac{5}{4}$，

```java
while(x <= y){
    if(d >= 0){
        x = x + 1;
        y = y - 1;
        d = d + 2 * (x - y) + 5;
    } else {
        x = x + 1;
        d = d + 2 * x + 3;
    }
    println("(" + x + ", " + y + ")");
}
```

